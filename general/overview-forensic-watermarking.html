---
title: '概述：法醫水印' 
description:“在本主題中，您將獲得 Brightcove 的取證水印功能的高級概述。”
parent: Forensic Watermarking
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

  <section class="bcls-section">
    <h2 id="Introduction">介紹</h2>
    <p>Brightcove 已與<a href="https://dtv.nagra.com/nexguard-forensic-watermarking">納格拉</a>提供取證水印作為視頻雲平台中的一項功能。這將有助於保護您的優質內容免遭盜版和未經授權的內容共享。此功能還有助於快速識別內容洩漏的來源，以便採取措施。</p>
  </section>
  <section class="bcls-section">
    <h2 id="Setup">設置</h2>
    <p>需要以下設置來支持 Brightcove 的取證水印解決方案：</p>
    <ol class="bcls-tasklist-restart">
      <li>
        與您的客戶經理聯繫：
        <ol>
          <li>確保您的帳戶已啟用動態交付。</li>
          <li>為您的帳戶啟用取證水印；這是 Video Cloud 的付費插件。</li>
        </ol>
      </li>
      <li>從<a href="https://dtv.nagra.com/nexguard-forensic-watermarking">納格拉</a> .</li>
      <li>生成一個公私鑰對，供取證水印 JWT 使用並由 CDN 解密。 （見下文）</li>
      <li>使用 NAGRA 提供的腳本生成用於取證水印的 JSON Web 令牌 (JWT)。請務必管理取證水印令牌和每個查看器的鏈接方式。當你需要它時<a href="#Configure_your_player">配置你的球員</a>以及在做檢測服務的情況下，知道哪個觀眾非法洩露了內容。</li>
    </ol>
    <p>
      有多種方法可以生成公私密鑰對。這裡有些例子：
    </p>
    <h3>
      bash腳本示例：
    </h3>
    <aside class="bcls-aside bcls-aside--information">請注意，下面的腳本使用<strong>知乎</strong>用於解析 JSON 的包。如果您沒有安裝 jq，請參閱<a href="https://github.com/stedolan/jq/wiki/Installation">安裝說明</a> .</aside>
    <p>
      生成密鑰對的示例腳本：
    </p>
<pre class="line-numbers"><code class="language-bash" translate="No">#!/bin/bash
set -euo pipefail

NAME=${1:-}
test -z "${NAME:-}" &amp;&amp; NAME="brightcove-forensic-watermarking-key-$(date +%s)"
mkdir "$NAME"

PRIVATE_PEM="./$NAME/private.pem"
PUBLIC_PEM="./$NAME/public.pem"
PUBLIC_TXT="./$NAME/public_key.txt"

ssh-keygen -t rsa -b 2048 -m PEM -f "$PRIVATE_PEM" -q -N ""
openssl rsa -in "$PRIVATE_PEM" -pubout -outform PEM -out "$PUBLIC_PEM" 2&gt;/dev/null
openssl rsa -in "$PRIVATE_PEM" -pubout -outform DER | base64 &gt; "$PUBLIC_TXT"

rm "$PRIVATE_PEM".pub

echo "Public key to saved in $PUBLIC_TXT"
</code></pre>
    <p>
      運行腳本：
    </p>
    <pre><code class="language-bash" translate="No">$ bash keygen.sh
</code></pre>

    <details id="Example_using_Go">
      <summary>使用示例<span translate="No">走</span></summary>
      <p>
        使用示例<span translate="No">走</span>生成密鑰對的編程語言：
      </p>
      <aside class="bcls-aside bcls-aside--tip">如果你是新手<span translate="No">走</span>，見<a href="https://golang.org/">這<span translate="No">走</span>編程語言</a>主頁。</aside>
<pre class="line-numbers"><code class="language-bash" translate="No">package main
  
  import (
    "crypto/rand"
    "crypto/rsa"
    "crypto/x509"
    "encoding/base64"
    "encoding/pem"
    "flag"
    "fmt"
    "io/ioutil"
    "os"
    "path"
    "strconv"
    "time"
  )
  
  func main() {
    var out string
  
    flag.StringVar(&amp;out, "output-dir", "", "Output directory to write files into")
    flag.Parse()
  
    if out == "" {
      out = "rsa-key_" + strconv.FormatInt(time.Now().Unix(), 10)
    }
  
    if err := os.MkdirAll(out, os.ModePerm); err != nil {
      panic(err.Error())
    }
  
    priv, err := rsa.GenerateKey(rand.Reader, 2048)
    if err != nil {
      panic(err.Error())
    }
  
    privBytes := x509.MarshalPKCS1PrivateKey(priv)
  
    pubBytes, err := x509.MarshalPKIXPublicKey(priv.Public())
    if err != nil {
      panic(err.Error())
    }
  
    privOut, err := os.OpenFile(path.Join(out, "private.pem"), os.O_WRONLY|os.O_CREATE|os.O_TRUNC, 0600)
    if err != nil {
      panic(err.Error())
    }
  
    if err := pem.Encode(privOut, &amp;pem.Block{Type: "RSA PRIVATE KEY", Bytes: privBytes}); err != nil {
      panic(err.Error())
    }
  
    pubOut, err := os.OpenFile(path.Join(out, "public.pem"), os.O_WRONLY|os.O_CREATE|os.O_TRUNC, 0600)
    if err != nil {
      panic(err.Error())
    }
  
    if err := pem.Encode(pubOut, &amp;pem.Block{Type: "PUBLIC KEY", Bytes: pubBytes}); err != nil {
      panic(err.Error())
    }
  
    var pubEnc = base64.StdEncoding.EncodeToString(pubBytes)
  
    var pubEncOut = path.Join(out, "public_key.txt")
    if err := ioutil.WriteFile(pubEncOut, []byte(pubEnc+"\n"), 0600); err != nil {
      panic(err.Error())
    }
  
    fmt.Println("Public key saved in " + pubEncOut)
  }
  </code></pre>
    </details>
    <br>

    <details id="Example_using_node_js">
      <summary>使用node.js的示例</summary>
      <p>
        使用node.js生成密鑰對的示例：
      </p>
      <aside class="bcls-aside bcls-aside--tip">此腳本示例需要節點版本 11 或更高版本。</aside>
  <pre class="line-numbers"><code class="language-javascript" translate="No">var crypto = require("crypto");
  var fs = require("fs");
  
  var now = Math.floor(new Date() / 1000);
  var dir = "rsa-key_" + now;
  fs.mkdirSync(dir);
  
  crypto.generateKeyPair(
    "rsa",
    {modulusLength: 2048},
    (err, publicKey, privateKey) =&gt; {
      fs.writeFile(
        dir + "/public.pem",
        publicKey.export({ type: "spki", format: "pem" }),
        err =&gt; {}
      );
      fs.writeFile(
        dir + "/public_key.txt",
        publicKey.export({ type: "spki", format: "der" }).toString("base64") +
          "\n",
        err =&gt; {}
      );
      fs.writeFile(
        dir + "/private.pem",
        privateKey.export({ type: "pkcs1", format: "pem" }),
        err =&gt; {}
      );
    }
  );
  
  console.log("Public key saved in " + dir + "/public_key.txt");</code></pre>
    </details>

  </section>
  <section class="bcls-section">
    <h2 id="Implementation">執行</h2>
    <p>您可以使用 Video Cloud Studio 實施取證水印，也可以使用 Brightcove API 手動完成。以下各節詳細介紹了這些方法。</p>
  </section>
  <section class="bcls-section"></section>
    <h2 id="Video_Cloud_Studio">影雲工作室</h2>
    <p>按照以下步驟在 Video Cloud Studio 中使用取證水印：</p>
    <ol class="bcls-tasklist-restart">
      <li>
        <p>取證水印與特定的攝取配置文件無關。您可以使用任何動態交付或上下文感知編碼配置文件。</p>
        <ol>
          <li>向 Brightcove 提供您的 NAGRA 許可證密鑰。此許可證密鑰將在轉碼期間用於生成水印。</li>
          <li>在裡面<strong>上傳</strong>模塊，選擇您的攝取配置文件。</li>
          <li>
            <p>檢查<strong>啟用取證水印</strong>選項。</p>
            <figure class="bcls-figure"><img class="bcls-image--no-border" alt="Enable watermarking option" src="/assets/images/general/forensic-watermarking/enable-watermarking.png" />
              <figcaption class="bcls-caption--image">啟用水印選項</figcaption>
              </figure> 
          </li>
          <li>
          添加標籤<code translate="No">watermarked</code>到視頻，因為這將使識別帶有取證水印的視頻變得更加容易<a href="#Analytics_reports">生成有關它們的分析報告</a>：
          <figure class="bcls-figure">
            <img class="bcls-image" src="/assets/images/general/forensic-watermarking/add-tag.png" alt="Add Tag">
            <figcaption class="bcls-caption--image">添加標籤</figcaption>
          </figure>
          </li>
          <li>
            <p>拖動或瀏覽您的視頻以開始攝取。</p>
            <aside class="bcls-aside bcls-aside--information">您可以攝取或重新轉碼要添加水印的視頻。</aside>
          </li>
        </ol>
      </li>
      <!-- <li>In the <strong>Media</strong> module, you can enable/disable your videos for watermarking.</li> -->
      <li id="Configure_your_player">
        <p>配置您的播放器。</p>
        <p>這是您將 NAGRA 水印令牌和查看者 ID 傳遞給播放器的地方。您可以使用 Brightcove 網絡播放器或本機 SDK 播放器：</p>
        <ul>
          <li><a href="https://player.support.brightcove.com/playback/forensic-watermarking-with-bcp.html">Brightcove Player 法醫水印</a></li>
          <li><a href="https://sdks.support.brightcove.com/features/forensic-watermarking-with-sdks.html">使用本機 SDK 進行取證水印</a></li>
          <!-- <li><a href="https://live.support.brightcove.com/general/forensic-watermarking-live.html">Forensic Watermarking with Live Streams</a></li> -->
        </ul>
      </li>
      <li>播放為取證水印提取的內容。</li>
    </ol>
  </section>

  <section class="bcls-section">
    <h2 id="Analytics_reports">分析報告</h2>
    <p>有關法醫水印視頻觀眾的分析報告可通過<a href="/analytics/index.html">分析 API</a>只要。報告可以以 JSON、CSV 或 XLXS 格式返回</p>
    <p>在分析數據中：</p>
    <pre><code translate="no">1 次交易 = 24 小時內每個視頻有 1 個唯一觀看者</code></pre>
    <aside class="bcls-aside bcls-aside--information language-editable">請注意，下面提供的一些示例假定您已添加標籤<code translate="No">watermarked</code>到帶有法醫水印的視頻。如果沒有，您將需要使用<code translate="No">where=video=={video_id}</code>過濾器（如第一個示例中所示）。</aside>
    <h3>示例 1：按日期查看視頻的觀眾</h3>
    <p>對於這個例子，我們將查詢<code translate="No">video</code> , <code translate="No">viewer</code>和<code translate="No">date</code>尺寸並以 CSV 格式返回報告。</p>
    <h4>樣品請求</h4>
<pre><code class="language-http" translate="No">https://analytics.api.brightcove.com/v1/data?accounts=4800266849001&from=2021-06-23&to=2021-06-25&dimensions=date,viewer&limit=10&where=video==70702952720202&fields=video,viewer,video_view&format=csv</code></pre>
    <h4>回复</h4>
<pre><code class="language-csv" translate="No">"date","video","viewer","video_view"
"2021-06-25","70702952720202","3f46037f932b0c5a","1"
"2021-06-24","70702952720202","3f46037f932b0c5a","2"</code></pre>
<p>請注意，<code translate="No">viewer</code>由 Brightcove 播放器生成並設置為基於用戶代理和 IP 的唯一字符串。理想情況下，您應該根據登錄 ID 自己設置查看者標識符 - 請參閱<a href="https://player.support.brightcove.com/playback/xdr-with-bcplayer.html#Set_the_user_identifier">這個話題</a>有關如何執行此操作的信息。您的標識符將基於可通過 JavaScript 檢索的信息。</p>
    <h3>示例 2：觀看人數</h3>
    <p>在這個例子中，我們假設所有帶有取證水印的視頻都有標籤<code translate="No">watermarked</code> .我們將再次查詢<code translate="No">video</code> , <code translate="No">viewer</code>和<code translate="No">date</code>維度並只返回一項，因為它是我們在這裡感興趣的摘要：</p>
    <h4>樣品請求</h4>
<pre><code class="language-http" translate="No">https://analytics.api.brightcove.com/v1/data?accounts=4800266849001&from=2021-06-23&to=2021-06-25&dimensions=date,viewer&limit=1&where=video.q==tags:watermarked</code></pre>
    <h4>回复</h4>
<pre class="line-numbers"><code class="language-json" translate="No">{
  "item_count": 7,
  "items": [
    {
      "date": "2021-06-25",
      "viewer": "07B1489C-5786-400E-945B-ABB3559B3897",
      "video_view": 1
    }
  ],
  "summary": {
    "video_view": 25
  }
}</code></pre>
  </section>

  <section class="bcls-section">
    <h2 id="APIs">蜜蜂</h2>
    <p>以下是與取證水印相關的 API 和字段：</p>
    <h3><a href="/dynamic-ingest/index.html">動態提取API</a></h3>
    <p>為帳戶啟用取證水印後，您可以通過將取證水印添加到視頻中<code translate="No">forensic_watermarking</code>字段到您的攝取請求，並將其設置為<code translate="No">true</code> .這可以針對原始攝取、替換或重新轉碼視頻來完成。</p>
    <h4>示例請求正文</h4>
<pre class="line-numbers"><code class="language-json" translate="No">{
  "master": {
          "url": "http://solutions.brightcove.com/video/Walking_Dead_609.mp4",
          "audio_tracks": [
              {
                  "language": "en",
                  "variant": "main"
              }
          ]
      },
    "profile": "multi-platform-standard-static-with-mp4",
    <span class="bc-highlight">"forensic_watermarking": true,</span>
    "capture-images": true
}</code></pre>
    <p>還有一個<code translate="No">forensic_watermarking_stub_mode</code>標誌，當設置為<code translate="No">true</code>產生可見的法醫水印：</p>
    <figure class="bcls-figure">
      <img class="bcls-image" src="/assets/images/general/forensic-watermarking/visible-watermarks.png" alt="Visible Forensic Watermarks">
      <figcaption class="bcls-caption--image">可見的取證水印</figcaption>
    </figure>
    <aside class="bcls-aside bcls-aside--information language-editable">注意<code translate="No">forensic_watermarking_stub_mode</code>只能使用 Dynamic Ingest API 進行設置。您不能使用上傳模塊設置它。</aside>
    <p><code translate="No">forensic_watermarking</code>還必須設置為<code translate="no">真的</code>啟用可見水印。</p>
    <p>在視頻上使用可見水印來測試集成（您應該使用至少 10 分鐘的視頻進行測試）。一旦您確認存在取證水印，您將希望刪除它們以僅具有不可見的取證水印。為此，您需要提交另一個動態攝取請求以重新轉碼視頻，這次設置<code translate="No">forensic_watermarking_stub_mode</code>到<code translate="No">false</code> .</p>
    <h4>可見取證水印的示例請求正文</h4>
<pre class="line-numbers"><code class="language-json" translate="No">{
  "master": {
          "url": "http://solutions.brightcove.com/video/Walking_Dead_609.mp4",
          "audio_tracks": [
              {
                  "language": "en",
                  "variant": "main"
              }
          ]
      },
    "profile": "multi-platform-standard-static-with-mp4",
    <span class="bc-highlight">"forensic_watermarking": true,</span>
    <span class="bc-highlight">"forensic_watermarking_stub_mode": true,</span>
    "capture-images": true
}</code></pre>
    <h4>移除可見取證水印的示例請求正文</h4>
<pre class="line-numbers"><code class="language-json" translate="No">{
    "profile": "multi-platform-standard-static-with-mp4",
    <span class="bc-highlight">"forensic_watermarking": true,</span>
    <span class="bc-highlight">"forensic_watermarking_stub_mode": false,</span>
    "capture-images": true
}</code></pre>
    
    <h3><a href="/cms/index.html">CMS API</a></h3>
    <p>默認情況下，如果在攝取期間請求了取證水印，則將提供取證水印再現。取證水印的存在將由只讀字段指示<code translate="No">forensic_watermarking</code> .如果該字段的值為<code translate="No">ACTIVE</code>，法醫水印被添加到VOD。如果該字段的值為<code translate="No">UNAVAILABLE</code>或者<code translate="No">null</code>，點播沒有法醫水印。</p>
      
      <!-- <p>You can disable this using a video update request to the CMS API and setting <code translate="No">forensic_watermarking</code> to <code translate="No">INACTIVE</code>. To enable delivery of forensic watermarked renditions again, send another update request setting <code translate="No">forensic_watermarking</code> to <code translate="No">ACTIVE</code>.</p>
    <p>For accounts not enable for forensic watermarking, <code translate="No">forensic_watermarking</code> will be <code translate="No">null</code> and not included in API responses</p>
    <h4>Sample request body</h4>
<pre class="line-numbers"><code class="language-json" translate="No">{
  "forensic_watermarking": "INACTIVE"
}</code></pre> -->

    <h3>播放接口</h3>
    <p>Playback API GET 視頻響應還將包含一個<code translate="No">forensic_watermarking</code>（如果該帳戶已啟用取證水印）。如果值為<code translate="No">ACTIVE</code>，帶有法醫水印的演繹將作為來源提供給玩家。否則，將交付未加水印的再現。</p>
    <h3><a href="https://zencoder.support.brightcove.com/index.html">編碼器</a></h3>
      <p>要在 Zencoder 中生成帶有取證水印的輸出，您需要為每個視頻指定 2 個輸出，一個帶有<code translate="no">“法醫水印”：“一種”</code>另一個與<code translate="no">“法醫水印”：“乙”</code>（這是僅有的兩個值<code translate="no">forensic_watermark</code>場可以有）。</p>
      <h4>示例請求（僅輸出）</h4>
<pre class="line-numbers"><code class="language-json" translate="No">{
  "outputs": [
      {
          "base_url": "s3://urlTest",
          "filename": "contextAwareEncoding1_A.m4f",
          "public": false,
          "format": "m4f",
          "label": "m4f-contextAwareEncoding1-A-b30e1",
          "generate_mp4_atom_map": true,
          "Mp4_atom_map_filename": "contextAwareEncod-A-atom_map.json",
          "skip_audio": true,
          <span class="bc-highlight">"forensic_watermark": "A"</span>,
          "dynamic_profile_rendition": 1,
          "skip": {
              "require_video": true
          },
          "fragment_duration": 2000,
          "segment_seconds": 2,
          "headers": {
              "x-amz-server-side-encryption": "AES256"
          }
      },
      {         
          "base_url": "s3://urlTest",
          "filename": "contextAwareEncoding1_B.m4f",
          "public": false,
          "format": "m4f",
          "label": "m4f-contextAwareEncoding1-B-e348",
          "generate_mp4_atom_map": true,
          "mp4_atom_map_filename": "contextAwareEncod-B-atom_map.json",
          "skip_audio": true,
          <span class="bc-highlight">"forensic_watermark": "B"</span>,
          "dynamic_profile_rendition": 1,
          "skip": {
              "require_video": true
          },
          "fragment_duration": 2000,
          "segment_seconds": 2,
          "headers": {
              "x-amz-server-side-encryption": "AES256"
          }
      }
  ]
}</code></pre>
    <h4>用於測試的可見水印</h4>
    <p>出於測試目的，要驗證是否存在取證水印，您可以通過添加強制可見取證水印<code translate="No">"forensic_watermark_stub_mode":true</code>輸出如下示例所示：</p>
<pre class="line-numbers"><code class="language-json" translate="No">{
  "outputs": [
      {
          "base_url": "s3://urlTest",
          "filename": "contextAwareEncoding1_A.m4f",
          "public": false,
          "format": "m4f",
          "label": "m4f-contextAwareEncoding1-A-b30e1",
          "generate_mp4_atom_map": true,
          "Mp4_atom_map_filename": "contextAwareEncod-A-atom_map.json",
          "skip_audio": true,
          <span class="bc-highlight">"forensic_watermark": "A"</span>,
          <span class="bc-highlight">"forensic_watermark_stub_mode":true</span>,
          "dynamic_profile_rendition": 1,
          "skip": {
              "require_video": true
          },
          "fragment_duration": 2000,
          "segment_seconds": 2,
          "headers": {
              "x-amz-server-side-encryption": "AES256"
          }
      },
      {         
          "base_url": "s3://urlTest",
          "filename": "contextAwareEncoding1_B.m4f",
          "public": false,
          "format": "m4f",
          "label": "m4f-contextAwareEncoding1-B-e348",
          "generate_mp4_atom_map": true,
          "mp4_atom_map_filename": "contextAwareEncod-B-atom_map.json",
          "skip_audio": true,
          <span class="bc-highlight">"forensic_watermark": "B"</span>,
          <span class="bc-highlight">"forensic_watermark_stub_mode":true</span>,
          "dynamic_profile_rendition": 1,
          "skip": {
              "require_video": true
          },
          "fragment_duration": 2000,
          "segment_seconds": 2,
          "headers": {
              "x-amz-server-side-encryption": "AES256"
          }
      }
  ]
}</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="supported_features">支持的功能</h2>
    <ul>
      <li>數字版權管理</li>
      <li>播放限制</li>
      <li>重新轉碼</li>
      <li>源文件替換</li>
      <li>合格證書</li>
      <li>離線下載</li>
      <li>Chromecast</li>
      <li>播放</li>
    </ul>

  </section>
  <section class="bcls-section">
    <h2 id="Limitations">局限性</h2>
    <ul>
      <li>目前僅支持點播。不支持實時流的取證水印。</li>
      <li>視頻必須至少有五分鐘長才能應用取證水印。</li>
      <li>不支持 HLSv7。HLSv7 用於傳輸 HEVC、混合編解碼器和 5.1 音頻 - 因此當前不支持 HEVC、混合編解碼器視頻和 5.1 音頻。</li>
      <li>當前不支持加密的 HLS 視頻 (HLSe)。</li>
      <li>此功能需要 NAGRA 許可證密鑰。</li>
      <li>玩家將需要使用 NAGRA 提供的腳本創建的法醫水印 JWT。</li>
      <li><a href="/delivery-rules/index.html">交貨規則</a>不能與用於傳送帶有法醫水印的視頻的播放器一起使用。</li>
      <li>您必須使用 Brightcove 的 CDN。不支持自帶 CDN。</li>
      <!-- <li>You are responsible for generating and managing the tokens used to identify each viewer.</li> -->
      <li>Brightcove 不會處理檢測分析。為此，請聯繫 NAGRA。</li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="related_topics">相關話題</h2>
    <ul>
      <li><a href="https://player.support.brightcove.com/playback/forensic-watermarking-with-bcp.html">Brightcove Player 法醫水印</a></li>
      <li><a href="https://sdks.support.brightcove.com/features/forensic-watermarking-with-sdks.html">使用本機 SDK 進行取證水印</a></li>
      <li><a href="https://zencoder.support.brightcove.com/encoding-guides/forensic-watermarking.html">編碼器：法醫水印</a></li>
      <li><a href="https://zencoder.support.brightcove.com/encoding-settings/content-protection/encoding-settings-forensic-watermarking.html">編碼器：取證水印設置</a></li>
    </ul>
  </section>
</article>