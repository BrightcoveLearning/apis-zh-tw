---
title: 'CMS API 通知'
description: '在本主題中，您將了解<span translate="No">內容管理系統 API</span>通知。這<span translate="No">內容管理系統 API</span>提供帳戶中視頻更改的通知，無論是帳戶用戶還是視頻雲系統。'
parent: 'Getting Started' 
grandparent: CMS API
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
  <h2 id="overview">概述</h2>
  
  <p>您可以在以下時間收到通知<code translate="No">video-change</code>事件發生在您的視頻庫中。通知將發送到您指定的 URL，該 URL 應指向能夠處理的應用程序<span translate="No">HTTP </span><code translate="No">POST</code>要求。</p>
  
  <h3>驗證</h3>
  
  <p>與對CMS API的所有請求一樣，設置或列出通知訂閱的請求必須使用<a href="/oauth/guides/getting-access-tokens.html">訪問令牌</a>。用於獲取訪問令牌的客戶端憑據必須具有以下權限<code translate="No">video-cloud/notifications/all</code> ( <strong translate="No"> CMS-&gt;通知</strong>如果你使用<a href="https://studio.support.brightcove.com/admin/managing-api-authentication-credentials.html">工作室用戶界面</a>創建憑據。）</p>
  
  <h3>設置</h3>
  
  <p>您最多可以指定 10 個端點來接收通知<code translate="No">POST</code>請求<code class="language-http" translate="No">https://cms.api.brightcove.com/v1/accounts/{account_id}/subscriptions</code>並在請求正文中包含 JSON，如下所示：</p>
  
  <pre class="line-numbers">
        <code class="language-json" translate="No">{
        "endpoint":"http://solutions.brightcove.com/bcls/di-api/di-callbacks.php",
        "events":["video-change"]
        }
        </code>
        </pre>
  
  <p>通知以JSON格式發送。這是一個例子：</p>
  
  <pre class="line-numbers">
        <code class="language-json" translate="No">{"timestamp":1423840514446,
        "account_id":"775205503001",
        "event":"video-change",
        "video":"4020894387001",
        "version":26}
        </code>
        </pre>
  
  <aside class="bcls-aside bcls-aside--information">除了通過 API 之外，目前沒有其他方法可以訂閱通知。</aside>
  
  <h3>通知欄位</h3>
  
  <table class="bcls-table">
    <thead class="bcls-table__head">
      <tr>
        <th>物品</th>
        <th>描述</th>
      </tr>
    </thead>
    <tbody class="bcls-table__body">
      <tr>
        <td ><code translate="No">timestamp</code></td>
        <td >事件發生的時間<span translate="No">時代</span>毫秒</td>
      </tr>
      <tr>
        <td ><code translate="No">account_id</code></td>
        <td >這<span translate="No">視頻雲</span>帳戶ID</td>
      </tr>
      <tr>
        <td ><code translate="No">event</code></td>
        <td >事件的類型 - 目前這將始終是<code translate="No">video-change</code></td>
      </tr>
      <tr>
        <td ><code translate="No">video</code></td>
        <td >視頻標識</td>
      </tr>
      <tr>
        <td ><code translate="No">version</code></td>
        <td >視頻的版本 - 每組更改事件都會增加視頻版本 - 例如，創建一組新的再現將構成一組更改事件</td>
      </tr>
    </tbody>
  </table>
  
  <p>創建訂閱的請求將收到<span translate="No">HTTP 422</span>以下情況的錯誤響應：</p>
  
  <ul>
    <li>這<code translate="No">endpoint</code>或者<code translate="No">events</code>請求正文中缺少字段</li>
    <li>這<code translate="No">events</code>字段值不是列表（數組）</li>
    <li>定義的訂閱已存在</li>
    <li>您已有 10 個訂閱此活動</li>
  </ul>
  
  <h3>通知失敗</h3>
  
  <p>通知系統處理任何<code translate="No">4xx</code>或者<code translate="No">5xx</code>作為可重試的失敗從客戶服務器返回。失敗的回調將最多重試20次，隨後的回調之間的延遲將成倍增加。前幾次重試將在初始回調嘗試後的幾分鐘內發生。如果回調繼續失敗，並且我們一直進行到第20次重試，則重試延遲將是幾天。</p>
  
  <aside class="bcls-aside bcls-aside--information">&gt;注意事項：
  <ul>
    <li><code translate="No">video-change</code>這些事件是由自動系統流程以及用戶操作觸發的，因此這些事件並不總是與您在Studio中或通過API對視頻屬性所做的更改相對應。</li>
    <li>當前不支持基於HTTP2構建的服務器上的通知處理程序。發送到 HTTP2 服務器的通知可能無法在不返回任何錯誤的情況下傳遞。</li>
  </ul>
  </aside>
  
  <h3>防火牆</h3>
  
  <p>如果您的組織對通過防火牆的傳入流量的來源有嚴格的政策，我們允許使用AWS us-east-1 / Virginia IP。這可能會發生變化，因此所有 AWS IP 都應列入白名單。看<a href="http://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html">http://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html</a>想要查詢更多的信息。</p>
  
  <h3>通知訂閱的端點</h3>
  
  <pre class="line-numbers">
        <code class="language-http" translate="No">/accounts/{account_id}/subscriptions
        </code>
        </pre>
  
  <h3 id="createSubscription">創建一個新的訂閱</h3>
  
  <p>要創建新訂閱，請提交<code translate="No">POST</code>帶有請求正文的請求，包括您希望將通知傳送到的端點和<code translate="No">video-change</code>作為一個單獨的項目<code translate="No">events</code>大批：</p>
  
  <pre class="line-numbers">
        <code class="language-json" translate="No">{ "endpoint": "http://solutions.brightcove.com:9002", "events": [ "video-change" ] }
        </code>
        </pre>
  
  <h3 id="getSubscriptions">獲取您的訂閱列表</h3>
  
  <p>要獲取所有訂閱的列表，請發送<code translate="No">GET</code>向訂閱端點發出請求。</p>
  
  <h3 id="getSubscription">獲取或刪除單個訂閱</h3>
  
  <p>使用以下端點獲取或刪除單個訂閱：</p>
  
  <h4>終點</h4>
  
  <pre class="line-numbers">
        <code class="language-http" translate="No">/accounts/{account_id}/subscriptions/{subscription_id}
        </code>
        </pre>
  
  <p>一種<code translate="No">GET</code>請求將檢索訂閱。一種<code translate="No">DELETE</code>請求將刪除訂閱。您此時無法更新訂閱。如果要修改訂閱，則需要將其刪除並創建一個新的訂閱。</p>
  </section>
  
  <section class="bcls-section">
  <h2 id="What_triggers">什麼觸發通知？</h2>
  
  <p><code translate="No">video-change</code>視頻元數據的任何更改都會觸發事件。這包括在 Studio 中或通過<span translate="No">內容管理系統 API</span>寫方法。還有系統事件會觸發<code translate="No">video-change</code>事件。</p>
  
  <p>將觸發事件的更改包括：</p>
  
  <ul>
    <li>視頻已創建</li>
    <li>開始攝取視頻或資產文件</li>
    <li>視頻或資產文件的提取已完成</li>
    <li>新演繹的編碼完成</li>
    <li>創建海報圖像</li>
    <li>創建縮略圖</li>
    <li>視頻已刪除</li>
    <li>視頻元數據被更改（由系統或用戶）</li>
  </ul>
  
  <h3>筆記</h3>
  
  <p>重新轉碼視頻不會觸發<code translate="No">video-change</code>事件，除非所得的演繹集不同。</p>
  
  <p>刪除視頻後會發生系統事件，因此您會在刪除視頻後收到有關視頻的通知。</p>
  
  <p>什麼會<strong>不是</strong>觸發一個<code translate="No">video-change</code>事件是對視頻資產的更改，但不會更改視頻元數據。例如，如果您替換遠程文本跟踪文件或圖像，但是視頻元數據中記錄的URL保持不變，則否<code translate="No">video-change</code>事件將會發生，並且不會發送任何通知。</p>
  </section>
  </article>