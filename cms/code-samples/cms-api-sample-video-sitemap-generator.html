---
title: '視頻站點地圖生成器'
description: '此示例演示瞭如何使用 CMS API 生成視頻站點地圖。'
parent: 'Code Samples' 
grandparent: CMS API
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Introduction">介紹</h2>

    <aside class="bcls-aside bcls-aside--information">提供此示例和相關代碼作為生產開發的指南。該代碼未經認證可用於生產用途，也未經官方支持。</aside>

    <p>在使用此應用之前，您應該閱讀<a href="https://studio.support.brightcove.com/general/making-your-video-content-indexable.html">使您的視頻內容可索引</a>以便更好地了解視頻站點地圖的目的以及使用CMS API自動生成視頻站點地圖的策略。為站點地圖生成XML非常簡單。最大的挑戰是您需要為每個視頻包含一個唯一的 URL，並且<span translate="No">內容管理系統 API</span>無法自動訪問此信息。為了克服這個問題，您可以做以下幾件事：</p>

    <ol>
      <li>將發布視頻的URL添加到視頻元數據中。最簡單的方法是創建一個<a href="https://studio.support.brightcove.com/admin/creating-custom-metadata-fields.html">自定義元數據字段</a>將 URL 存儲在其中。</li>
      <li>使用URL參數將視頻託管在單個頁面上<code translate="No">id</code>或者<code translate="No">reference_id</code>頁面中的自定義JavaScript將用於將視頻加載到播放器中。
        <p>有多種方法可以獲取頁面的特定 URL 參數的值。以下是我們在一些示例應用程序中使用的功能：</p>

        <pre class="line-numbers">
            <code class="language-javascript" translate="No">/**
             * gets value of a URL param on current page URL if exists
             * @param {string} name the param you want the value of
             * @return {string} result value of param if exists or null
             */
            function getURLparam(name) {
                var regex,
                    results;
                name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)");
                results = regex.exec(location.search);
                return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, " "));
            }</code></pre>

        <p>一旦有了<code translate="No">id</code>或者<code translate="No">reference_id</code>，您需要將其添加到播放器中。具體操作方式取決於您是否使用標準（<code translate="No">iframe</code>）或高級（頁內）播放器嵌入代碼。可能最簡單，最安全的方法是&nbsp;至<a href="https://player.support.brightcove.com/code-samples/brightcove-player-sample-loading-player-dynamically.html">動態加載播放器</a>（或不，如果由於某種原因不存在帶有id的URL參數）。</p>

        <p>可以用於此目的的HTML單頁示例是<a href="#Single_page">單頁</a>下面的部分。</p>
      </li>
    </ol>

    <p>下面的示例應用程序允許您使用任一方法 - 您只需通過在適當的字段中輸入信息來告訴它哪種方法。</p>

    <h3>關於示例應用程序的注意事項：</h3>

    <ol>
      <li>該應用程序向<span translate="No">分析 API</span>獲取所有時間的視頻觀看次數，因此如果您提供的客戶端憑據不包含 Analytics API 的權限，應用程序將失敗。</li>
      <li>可以包含的最大視頻數為 50,000，文件大小也有 50mb 的限制，您可能會遇到少於 50,000 個視頻的情況。如果要包含的視頻多於視頻，則必須將其拆分為多個站點地圖，並添加一個站點地圖索引文件。看<a href="https://support.google.com/webmasters/answer/80471">谷歌的站點地圖文檔</a>想要查詢更多的信息。</li>
      <li>示例應用程序生成的站點地圖不包含一些視頻的可選標籤（有關它們的信息，請參閱上面引用的 Google 文檔）。如果您想包括這些內容，則可以從此應用程序中獲取代碼並創建修改後的版本。JavaScript 和 HTML 代碼中有註釋來指示您需要做什麼。
        <table class="bcls-table">
          <caption class="bcls-caption--table">是否包含可選標籤</caption>
          <thead class="bcls-table__head">
            <tr>
              <th>包括標籤</th>
              <th>不包括標籤</th>
            </tr>
          </thead>
          <tbody class="bcls-table__body">
            <tr>
              <td>
                <ul>
                  <li>player_loc</li>
                  <li>期間</li>
                  <li>expiration_date（如果適用）</li>
                  <li>查看次數</li>
                  <li>發布日期</li>
                  <li>家庭友善</li>
                  <li>（地理位置）限制（如果有）</li>
                </ul>
              </td>
              <td>
                <ul>
                  <li>content_loc</li>
                  <li>評分</li>
                  <li>平台</li>
                  <li>價格</li>
                  <li>require_subscription</li>
                  <li>上傳者</li>
                  <li>居住</li>
                  <li>標籤</li>
                  <li>類別</li>
                  <li>gallery_loc</li>
                </ul>
              </td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>不滿足必要條件的視頻將被跳過，如下所示：
        <ul>
          <li>如果要將視頻頁面URL存儲在自定義字段中，則任何沒有該自定義字段值的視頻</li>
          <li>如果您使用單個頁面託管視頻，並使用<code translate="No">reference_id</code>包括它們，而視頻缺乏<code translate="No">reference_id</code></li>
          <li>該視頻沒有縮略圖</li>
          <li>該視頻沒有 MP4 格式</li>
          <li>該視頻無效</li>
          <li>該視頻計劃在未來的某個日期開始</li>
          <li>該視頻原定於當前日期之前結束</li>
        </ul>

        <p>請注意，對於任何被跳過的視頻，我都會向瀏覽器控制台記錄一條消息，指示原因和視頻ID。</p>
      </li>
    </ol>

    <p>最後，如果您想在生成站點地圖後對其進行驗證，那麼網絡上有幾個免費的工具可以執行此操作-例如：</p>

    <p><a href="https://www.inspyder.com/free/SitemapValidator.aspx">免費的Sitemap驗證器</a></p>
  </section>

  <section class="bcls-section">
    <details>
      <summary>
        <h2 id="getCredentials">獲取憑證</h2>
      </summary>

      <p>要使用<span translate="No">內容管理系統 API</span>您將需要適當的憑據。</p>

      <p>在大多數情況下，獲取憑據的最簡單方法是通過 Studio Admin API 身份驗證部分（需要您帳戶的管理員權限）。看<a href="/general/managing-api-authentication-credentials.html">管理 API 身份驗證憑據</a>詳情。在大多數情況下，您可能只想獲得所有權限<span translate="No">內容管理系統 API</span>手術：</p>

      <figure class="bcls-figure"><img class="bcls-image" alt="CMS API Permissions" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/cms-api/cms-permissions.png" />
        <figcaption class="bcls-caption--image">CMS API權限</figcaption>
      </figure>

      <p>如果Studio中沒有所需的權限，或者您希望直接從OAuth API獲取權限，請選擇<strong>獲取客戶憑證</strong>下面列出的文件。無論您選擇哪個選項，您都需要請求正確的操作權限。以下內容可與 cURL、Postman 或我們的在線應用程序一起使用，以獲取 CMS API 的所有權限：</p>

      <pre class="line-numbers">
              <code class="language-json" translate="No">"operations": [
                "video-cloud/video/all",
                "video-cloud/playlist/all",
                "video-cloud/sharing-relationships/all",
                "video-cloud/notifications/all"
                "video-cloud/analytics/read"
              ]</code></pre>

      <ul>
        <li><a href="/oauth/guides/oauth-create-client-credentials-using-curl.html">OAuth：使用cURL獲取客戶端憑據</a></li>
        <li><a href="/oauth/guides/oauth-create-client-credentials-using-postman.html">OAuth：使用郵遞員獲取客戶憑證</a></li>
        <li><a href="/oauth/code-samples/oauth-api-sample-create-client-credentials.html">OAuth API示例：創建客戶端憑證</a></li>
      </ul>
    </details>
  </section>

  <section class="bcls-section">
    <h2 id="sampleApp">示例應用程序</h2>
    <h3>源代碼</h3>
    <p>在此找到與此樣本相關的所有代碼<a href="https://github.com/BrightcoveLearning/18739-cms-api-sample-video-sitemap-generator">GitHub資料庫</a>。</p>
    <h3>示例應用程序</h3>
    <p class="codepen" data-height="1200" data-theme-id="34967" data-default-tab="result" data-user="rcrooks1969" data-slug-hash="VRLNJp" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CMS API Sample: Video Sitemap Generator"><span>看筆<a href="https://codepen.io/team/rcrooks1969/pen/VRLNJp/"><span translate="No">內容管理系統 API</span>樣本：視頻站點地圖生成器</a>通過 Brightcove 學習服務 ( <a href="https://codepen.io/rcrooks1969"> @rcooks1969</a>） 在<a href="https://codepen.io">代碼筆</a> .</span></p>
    <script async="async" src="https://static.codepen.io/assets/embed/ei.js"></script>
  </section>

  <section class="bcls-section">
    <details>
      <summary>
        <h2 id="Using_the_CodePen">使用代碼筆</h2>
      </summary>

      <p>以下是一些有效使用上述 CodePen 的提示：</p>

      <ul>
        <li>通過單擊切換播放器的實際顯示<strong>結果</strong>按鈕。</li>
        <li>點擊<strong>HTML / CSS / JS</strong>按鈕顯示一種代碼類型。</li>
        <li>點擊<strong>在CodePen上編輯</strong>在右上角將此CodePen分支到您自己的帳戶中。</li>
        <li>在此找到與此樣本相關的所有代碼<a href="https://github.com/BrightcoveLearning/18739-cms-api-sample-video-sitemap-generator">GitHub資料庫</a>。</li>
      </ul>
    </details>
  </section>

  <section class="bcls-section">
    <h2 id="Single_page">單頁</h2>

    <p>如上所述，您可以創建一個HTML頁面，該頁面可用於每個視頻的位置。該應用程序將使用定義頁面應使用的視頻 ID 的查詢參數來更改頁面的 URL。例如，應用程序將生成JSON，其中包含與視頻頁面位置類似的位置URL：</p>

    <pre class="line-numbers">
            <code class="language-json" translate="No">&lt;loc&gt;
                &lt;![CDATA[http://my.site.net/videos.html?videoId=5984663997001]]&gt;
            &lt;/loc&gt;
            ...
            &lt;loc&gt;
                &lt;![CDATA[http://my.site.net/videos.html?videoId=5982130568001]]&gt;
            &lt;/loc&gt;</code></pre>

    <p>請注意，只有視頻ID在更改。</p>

    <p>實際的 HTML 頁面讀取<strong>視頻ID</strong> URL 參數然後使用從 URL 獲取的視頻 ID 動態生成播放器。整個 HTML 頁面如下所示：</p>

    <pre class="line-numbers">
            <code class="language-html" translate="No">&lt;!doctype html&gt;
            &lt;html&gt;
            
            &lt;head&gt;
              &lt;meta charset="UTF-8"&gt;
              &lt;title&gt;Load Player Dynamically from URL Param&lt;/title&gt;
              &lt;!-- Page styles --&gt;
              &lt;style&gt;
                .video-js {
                  width: 640px;
                  height: 360px;
                }
              &lt;/style&gt;
            &lt;/head&gt;
            
            &lt;body&gt;
              &lt;div id="placeHolder"&gt;&lt;/div&gt;
              &lt;!-- custom script --&gt;
              &lt;script type="text/JavaScript"&gt;
                var myPlayer,
                  playerHTML,
                  playerData = {},
                  theURLParam = '',
                  // Set the account ID to your account
                  myAccountId = '1507807800001';
            
                 // Read URL param for video ID
                theURLParam = geturlparam('videoId');
            
                // Assign data for the player instantiation
                playerData = {
                  'accountId': myAccountId,
                  'playerId': 'default',
                  'videoId': theURLParam
                };
            
                // Call function that builds player
                addPlayer();
            
                /**
                 * gets value of a url param on current page url if exists
                 * @param {string} name the param you want the value of
                 * @return {string} result value of param if exists or null
                 */
                function geturlparam(name) {
                  var regex,
                    results;
                  name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                  regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)");
                  results = regex.exec(location.search);
                  return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, " "));
                };
            
                // Dynamically adds player to page
                function addPlayer() {
                  // Dynamically build the player video element
                  playerHTML = '&lt;video-js id=\"myPlayerID\" data-video-id=\"' + playerData.videoId + '\"  data-account=\"' + playerData.accountId + '\" data-player=\"' + playerData.playerId + '\" data-embed=\"default\" class=\"video-js\" controls&gt;&lt;/video-js&gt;';
                  // Inject the player code into the DOM
                  document.getElementById('placeHolder').innerHTML = playerHTML;
                  // Add and execute the player script tag
                  var s = document.createElement('script');
                  s.src = "https://players.brightcove.net/" + playerData.accountId + "/" + playerData.playerId + "_default/index.min.js";
                  document.body.appendChild(s);
                  s.onload = callback;
                }
            
                 // Initialize the player and start the video
                function callback() {
                  myPlayer = bc('myPlayerID');
                  // Can also use the following to assign a player instance to the variable if you choose not to use IDs for elements directly
                  // myPlayer = bc(document.getElementById('myPlayerID'));
                  myPlayer.on('loadedmetadata', function () {
                    // Mute the audio track, if there is one, so video will autoplay on button click
                    myPlayer.muted(true);
                    myPlayer.play();
                  })
                }
              &lt;/script&gt;
            &lt;/body&gt;
            
            &lt;/html&gt;</code></pre>

    <p>您必須輸入您的帳號。有關代碼的完整說明，請參見<a href="https://player.support.brightcove.com/code-samples/brightcove-player-sample-loading-player-dynamically.html">Brightcove Player示例：動態加載播放器</a>文檔。</p>
  </section>

    <section class="bcls-section">
    <details>
      <summary>
        <h2 id="proxy">代理代理代碼</h2>
      </summary>

      <p>為了建立您自己的版本此頁面上的範例應用程式，您必須建立並裝載您自己的 Proxy。（布萊特灣學習服務所使用的代理只接受來自布萊特灣域的請求。）可以在以下位置找到一個示例代理，該代理與我們使用的代理代理非常相似，但是沒有檢查阻止來自非Brightcove域的請求。<a href="https://github.com/BrightcoveLearning/sample-proxy-apps">這個GitHub倉庫</a>。您還將在那裡找到使用它的基本說明，以及圍繞代理構建應用程序的更詳細指南<a href="/getting-started/learning-guide-using-rest-apis.html">使用 REST API</a> .</p>
    </details>
  </section>

</article>