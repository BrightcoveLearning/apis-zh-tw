---
title: '播放器管理示例的設置'
description: '此頁面描述瞭如何編寫新播放器的基本示例。這包括有關基本身份驗證以及如何在播放器管理 API 示例中使用 AJAX 的詳細信息。'
parent: Code Samples 
grandparent: Player Management API
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
    <section class="bcls-section">
    <h2 id="Introduction">介紹</h2>
    
    <p>在分步中：您使用curl語句與Player管理文件進行交互的API。進行 API 調用時，系統會以交互方式提示您輸入密碼。雖然這對 curl 很有效，但在構建應用程序時這種交互式身份驗證是不可行的。</p>
    
    <p>在這裡，您將學習如何使用JavaScript和XMLHttpRequest（也稱為AJAX）發出API請求，以構建用於播放器管理操作的Web客戶端。</p>
    
    <p>因為播放器管理API是<a href="https://general.support.brightcove.com/developer/concepts-cors.html">啟用CORS</a>並允許使用您的Brightcove登錄憑據進行基本身份驗證，就像在Player Management API示例中所做的那樣，可以直接從網頁發出API請求。Brightcove的其他RESTful API需要通過以下方式進行身份驗證<a href="/oauth/index.html">OAuth</a>。由於用於檢索訪問令牌的 API 未啟用 CORS（API 本身也未啟用），因此您必須通過服務器端應用程序發出請求。看<a href="/getting-started/learning-guide-using-rest-apis.html">使用 REST API</a>有關使用 Web UI 和代理構建混合應用程序以訪問 REST API 的指南。這也是我們為在生產中使用 Player Management API 的應用程序推薦的方法，因為它更安全，不通過 HTTP 連接發送憑據。</p>
    
    <aside class="bcls-aside bcls-aside--warning">
    <p>此頁面上引用的示例應用程序旨在讓您探索 Player Management API 的基礎知識。它們並不意味著成為企業就緒、可部署的應用程序。例如，表單驗證不是詳盡無遺的，並且密碼不是使用HTTPS發送的。</p>
    </aside>
    </section>
    
    <section class="bcls-section">
    <h2 id="Basic_authentication">基本認證</h2>
    
    <p>在分步中：您使用curl語句與Player管理文件進行交互的API。進行 API 調用時，系統會以交互方式提示您輸入密碼。雖然這對 curl 很有效，但在構建應用程序時這種交互式身份驗證是不可行的。</p>
    
    <p>您可以在構建應用程序時使用基本身份驗證。在標頭中，您需要發送憑據，並以64位編碼的ASCII字符串進行加密。您可以使用 JavaScript <code translate="No">btoa()</code>方法進行編碼。假設<code translate="No">account_username</code>和<code translate="No">account_password</code>從（例如）表單填充時，Authorization標頭將如下所示：</p>
    
    <pre class="line-numbers">
    <code class="language-javascript" translate="No"> "Authorization": "Basic " + btoa(account_username + ":" + account_password),</code></pre>
    </section>
    
    <section id="ajax" class="bcls-section">
    <h2>AJAX</h2>
    
    <aside class="bcls-aside bcls-aside--information">
    <p>在本節中，您將學習如何通過以下方式使用AJAX：<a href="//jquery.org"> jQuery的</a>。 jQuery將與發出AJAX請求有關的命令封裝到ajax（）函數中，從而簡化了開發人員的工作。但是，AJAX不需要jQuery，在接下來的部分中，我們將向您展示如何使用純JavaScript發出AJAX請求。</p>
    </aside>
    
    <p>這些示例將使用JavaScript與API進行通信，而不是使用curl語句。這意味著使用 AJAX 向 API 發出請求。一個特定的示例請求可能看起來像這樣：</p>
    
    <pre class="line-numbers">
    <code class="language-javascript" translate="No">$.ajax({
        type: "DELETE",
        headers: {
        "Authorization": "Basic " + btoa("username:password"),
        "Content-Type": "application/json"
        },
        url: "https://players.api.brightcove.com/v2/accounts/123456789/players/478772a5-a2f2-44c6-a26b-2d7234bd97f5",
        success: ajaxSuccess,
        error: ajaxError
    });</code></pre>
    
    <p>聯繫<code translate="No">success</code>和<code translate="No">error</code>處理程序可能看起來像這樣：</p>
    
    <pre class="line-numbers">
    <code class="language-javascript" translate="No">var ajaxSuccess = function (data) {
        document.getElementById("jsonResponse").innerHTML = JSON.stringify(data,null,2);
        };
    
        var ajaxError = function (data) {
        console.log("error data: ");
        console.log(data);
    };</code></pre>
    
    <p>當然，您不想像上面所示那樣對AJAX調用中的所有信息進行硬編碼，因此有意義的是將實際調用抽象為可重用的函數，如下所示：</p>
    
    <pre class="line-numbers">
    <code class="language-javascript" translate="No">var makeAjaxCall = function (callURL, callType, callData) {
        if (callData) {
            $.ajax({
                type: callType,
                headers: {
                    "Authorization": "Basic " + btoa(account_username + ":" + account_password),
                    "Content-Type": "application/json"
                },
                url: callURL,
                data: JSON.stringify(callData),
                success: ajaxSuccess,
                error: ajaxError
            });
        } else {
            $.ajax({
            type: callType,
            headers: {
                "Authorization": "Basic " + btoa(account_username + ":" + account_password),
                "Content-Type": "application/json"
            },
            url: callURL,
            success: ajaxSuccess,
            error: ajaxError
            });
        }
    };</code></pre>
    <!-- <code data-gist-id="9216425" data-gist-hide-footer="true" data-gist-line="22-47"></code><br /> -->
    
    <aside class="bcls-aside bcls-aside--information">如果需要通過 API 調用傳遞數據，則會構建單獨的調用。在逐步中：您已經看到了兩個用例的播放器管理文檔。發布播放器不需要傳遞任何數據，而使用媒體源創建播放器則需要傳遞數據。</aside>
    
    <p>然後您就可以調用該函數了。在以下示例中<code translate="No">account_id</code>，<code translate="No">account_password</code>和<code translate="No">account_username</code>值都是從表單中提取的。</p>
    
    <pre class="line-numbers">
    <code class="language-javascript" translate="No">var getPlayerInfo = function () {
        account_id = document.getElementById("account_id").value,
        account_password = document.getElementById("account_password").value,
        account_username = document.getElementById("account_username").value;
        call_url = "https://players.api.brightcove.com/v2/accounts/" + account_id + "/players";
        makeAjaxCall(call_url, "GET", null);
    };</code></pre>
    <!-- <code data-gist-id="9216425" data-gist-hide-footer="true" data-gist-line="49-55"></code><br /> -->
    
    <p>如果您已完成分步操作：您已經知道播放器管理文檔，其中有些過程需要多個API調用，例如創建和發布播放器。同樣，某些應用程序的邏輯可能需要多次API調用，例如獲取要顯示的所有播放器的列表，然後刪除用戶標記的播放器。在這些情況下，您很可能需要更改您的<code translate="No">success</code>處理程序根據剛剛成功執行的調用執行不同的邏輯。在這些示例應用程序中，將使用標誌變量來實現這些用例的實現邏輯，<code translate="No">callPurpose</code>和<code translate="No">case</code>使用該標誌的語句，如下所示：</p>
    
    <pre class="line-numbers">
    <code class="language-javascript" translate="No">var ajaxSuccess = function (data) {
        switch (callPurpose) {
            case "getPlayers":
                createCheckboxes(data);
                watchCheckboxes();
                break;
            case "deletePlayer":
                document.getElementById("jsonResponse").textContent += data;
                break;
        }
    };</code></pre>
    </section>
    
    <section class="bcls-section">
    <h2 id="AJAX_without_jquery">沒有jQuery的AJAX</h2>
    
    <p>如果您不想使用jQuery，則發出AJAX請求會稍微複雜一點，但不會太多。這是一些帶有註釋的示例代碼，可以幫助您入門：</p>
    
    <pre class="line-numbers">
    <code class="language-javascript" translate="No">/**
     * createRequest sets up requests, send them to makeRequest(), and handles responses
     * @param  {string} type the request type
     */
    function createRequest(type) {
        var options   = {},
            baseURL = 'https://players.api.brightcove.com/v2/accounts/',
            account_id = '1234567890',
            // would be better to get these from form fields
            // and not hardcode them
            username = 'jane@myplace.com',
            password = 'mypassword',
            responseDecoded;
    
        // set credentials
        options.client_id     = cid.value;
        options.client_secret = secret.value;
    
        switch (type) {
            case 'getPlayers':
                options.url         = ipBaseURL + account_id + '/players';
                options.requestType = 'GET';
                options.username = username;
                options.password = password;
                makeRequest(options, function(response) {
                    // use try catch in case something went wrong
                    try {
                        responseDecoded = JSON.parse(response);
                        // now do whatever you want with the response
                    }
                    catch (e) {
                        console.log('something went wrong - this was the JSON.parse error: ' + e);
                    }
                });
                break;
            // additional cases
            default:
                console.log('Should not be getting to the default case - bad request type sent');
                break;
        }
    }
    
    /**
     * send API request
     * @param  {Object} options for the request
     * @param  {String} options.url the full API request URL
     * @param  {String="GET","POST","PATCH","PUT","DELETE"} requestData [options.requestType="GET"] HTTP type for the request
     * @param  {String} options.username username for the account
     * @param  {String} options.password password for the account
     * @param  {JSON} [options.requestBody] Data (if any) to be sent in the request body in the form of a JSON string
     * @param  {Function} [callback] callback function that will process the response
     */
    function makeRequest(options, callback) {
        var httpRequest = new XMLHttpRequest(),
            response,
            requestParams,
            dataString,
            // response handler
            getResponse = function() {
                try {
                    if (httpRequest.readyState === 4) {
                        // don't just check for status = 200
                        // some requests return other 2xx codes
                        if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status &lt; 300) {
                            response = httpRequest.responseText;
                            // return the response to the callback
                            callback(response);
                        } else {
                            alert('There was a problem with the request. Request returned ' + httpRequest.status);
                        }
                    }
                } catch (e) {
                    alert('Caught Exception: ' + e);
                }
            };
        /**
         * set up request data
         */
        // set response handler
        httpRequest.onreadystatechange = getResponse;
        // open the request
        httpRequest.open(options.requestType, options.url);
        // set headers
        httpRequest.setRequestHeader("Content-Type", "application/json");
        httpRequest.setRequestHeader("Authorization", "Basic " + btoa(options.username + ":" + options.password));
        // open and send request
        if (options.requestBody) {
            httpRequest.send(options.requestBody)
        } else {
            httpRequest.send();
        }
    }</code></pre>
    </section>
    </article>
 