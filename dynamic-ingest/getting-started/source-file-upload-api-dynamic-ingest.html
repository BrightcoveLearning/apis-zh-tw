---
title: '用於動態攝取的源文件上傳 API'
description: '在本主題中，您將了解如何使用用於動態攝取的源文件上傳 API 將視頻添加到您的 Video Cloud 帳戶。源文件上傳 API 提供了通過動態攝取將源文件上傳（“推送”）到視頻雲的能力。'
parent: Getting Started 
grandparent: Dynamic Ingest API
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
    <section class="bcls-section">
    <h2 id="Introduction">介紹</h2>
    
    <p>為了通過源文件上傳進行提取，Brightcove提供了一個S3存儲桶，您可以將視頻和資產文件上傳到其中，然後Dynamic Ingest以與從您自己的S3存儲桶或URL中提取視頻相同的方式從S3存儲桶中提取視頻。下圖顯示了基本動態攝取和使用源文件上傳的攝取工作流之間的區別。</p>
    
    <figure class="bcls-figure"><img class="bcls-image" alt="Workflow Differences" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/di-api/guides/push-based-ingest/source-file-upload.png" />
    <figcaption class="bcls-caption--image">工作流程差異</figcaption>
    </figure>
    </section>
    
    <section class="bcls-section">
    <h2 id="FAQ">常問問題</h2>
    
    <dl>
      <dt class="bcls-question">暫時將視頻存儲多長時間？這些URL何時無效？</dt>
      <dd class="bcls-answer">視頻在上傳 24 小時後會從臨時存儲中移除，此後其 URL 將不再有效。</dd>
      <dt class="bcls-question">返回的 S3 憑據需要多長時間<span translate="No">動態攝取 API</span>有效的？</dt>
      <dd class="bcls-answer">S3 憑證在 API 發送後的 24 小時內也有效。</dd>
      <dt class="bcls-question">24小時後是否從S3存儲桶中物理刪除了視頻文件？</dt>
      <dd class="bcls-answer">是的</dd>
      <dt class="bcls-question">成功提取視頻後，它們是否會從S3存儲桶中刪除？</dt>
      <dd class="bcls-answer">不論是否成功提取了所有視頻，所有視頻都會在24小時後從臨時存儲中刪除。</dd>
      <dt class="bcls-question">擁有URL的人可以公開訪問臨時存儲區中的視頻嗎？</dt>
      <dd class="bcls-answer">沒有</dd>
      <dt class="bcls-question">沒有安全憑證，有什麼方法可以下載或觀看臨時存儲區中的視頻？</dt>
      <dd class="bcls-answer">沒有</dd>
      <dt class="bcls-question">與其他Brightcove客戶共享訪問臨時存儲的安全憑證嗎？</dt>
      <dd class="bcls-answer">不可以，任何使用臨時存儲的客戶都將獲得唯一的安全憑證。</dd>
      <dt class="bcls-question">其他Brightcove客戶是否可以使用自己的安全憑證訪問臨時存儲區中的我的視頻？</dt>
      <dd class="bcls-answer">否，安全憑證僅提供對您推送到臨時存儲的視頻的訪問。</dd>
      <dt class="bcls-question">用於文件上傳的 S3 存儲桶位於哪個區域？</dt>
      <dd class="bcls-answer">US-EAST-1（這是固定的）。</dd>
    </dl>
    </section>
    
    <section class="bcls-section">
    <h2 id="Source_file_names">源文件名</h2>
    
    <p>為避免在 Brightcove Player 中訪問視頻和資產時出現問題，您應避免在源文件名中使用任何特殊字符，無論是視頻、圖像還是文本軌道（WebVTT 文件）。這也適用於遠程資產。文件名應僅包括以下內容：</p>
    
    <ul>
      <li><strong>單字節</strong>字母（大寫或小寫）</li>
      <li>號碼</li>
      <li>破折號（-）和下劃線（_）</li>
      <li>空間<strong>如果它們是 URL 編碼的</strong></li>
    </ul>
    </section>
    
    <section id="Authentication" class="bcls-section">
    <h2>驗證</h2>
    
    <p>獲取動態攝取的客戶端憑據的最簡單方法是通過<a href="/general/managing-api-authentication-credentials.html">API 身份驗證的 Studio 管理頁面</a> .對於API權限，您至少需要：</p>
    
    <ul>
      <li>CMS&gt;視頻閱讀</li>
      <li>動態提取&gt;創建</li>
      <li>動態提取&gt;推送文件（這是新的源文件上傳API）</li>
    </ul>
    
    <figure class="bcls-figure"><img class="bcls-image" alt="API Authetication" src="/assets/images/dynamic-ingest/getting-started/source-file-upload.png" />
    <figcaption class="bcls-caption--image">API認證</figcaption>
    </figure>
    
    <p>對於基於推送的攝取的Brightcove API請求的身份驗證，與針對以下請求的請求相比，需要一個額外的權限<a href="/dynamic-ingest/getting-started/overview-dynamic-ingest-api-dynamic-delivery.html#operations">其他動態提取請求</a>：</p>
    
    <pre class="line-numbers">
      <code class="language-bash" translate="No">video-cloud/upload-urls/read</code></pre>
    
    <p>源文件上傳所需的全套權限為：</p>
    
    <ul>
      <li>視頻雲/視頻/創建</li>
      <li>視頻雲/視頻/閱讀</li>
      <li>視頻雲/視頻/更新</li>
      <li><span class="bcls-highlight">視頻雲/上傳網址/閱讀</span></li>
    </ul>
    
    <p>這些權限可在<a href="/getting-started/authentication-brightcove-api-requests.html">工作室</a> .或者，您可以通過發出POST請求，從OAuth API獲得客戶端憑據以直接使用源文件上傳API，如下所示：</p>
    
    <h3>要求網址</h3>
    
    <pre class="line-numbers">
      <code class="language-http" translate="No">https://oauth.brightcove.com/v4/client_credentials</code></pre>
    
    <h3>標頭</h3>
    
    <ul>
      <li><code translate="No">Authorization: BC_TOKEN <span class="bcls-highlight">{YOUR_BC_TOKEN}</span> </code></li>
      <li>
      <div>內容類型：application / json</div>
      </li>
    </ul>
    
    <h3>要求正文</h3>
    
    <pre class="line-numbers">
      <code class="language-json" translate="No">{
      "type": "credential",
      "maximum_scope": [
      {
        "identity": {
          "type": "video-cloud-account",
          "account-id": <span class="bcls-highlight">{YOUR_ACCOUNT_ID}</span>
        },
        "operations": [
          "video-cloud/upload-urls/read",
          "video-cloud/video/create",
          "video-cloud/video/read",
          "video-cloud/video/update",
          "video-cloud/ingest-profiles/profile/write",
          "video-cloud/ingest-profiles/account/write",
          "video-cloud/ingest-profiles/profile/read",
          "video-cloud/ingest-profiles/account/read"
        ]
      }
      ],
      "name": "Source File Upload Credentials"
      }</code></pre>
    </section>
    
    <section class="bcls-section">
    <h2 id="API_requests">API請求</h2>
    
    <p>基於推送的攝取涉及四個 API 請求：</p>
    
    <ol>
      <li>CMS API POST請求以在Video Cloud中創建視頻對象（與基於拉取的提取相同）</li>
      <li>動態獲取GET請求以獲取Brightcove S3存儲桶URL</li>
      <li>PUT請求將源文件上傳到Brightcove S3存儲桶</li>
      <li>動態提取POST請求以提取源文件（與基於拉取的提取相同）</li>
    </ol>
    
    <aside class="bcls-aside bcls-aside--information">
    <p>這<span translate="No">內容管理系統 API</span>和<span translate="No">動態攝取 API</span>請求必須來自服務器端應用程序或<a href="/getting-started/learning-guide-using-rest-apis.html">代理</a> .將文件上傳到 S3 存儲桶的 PUT 請求可以直接從客戶端應用程序或服務器應用程序發出。</p>
    
    <p>如果您要從網站（客戶端）上載視頻，則此庫可簡化您獲得流暢用戶體驗所需的步驟：<a href="https://github.com/BrightcoveOS/evaporate-brightcove"> https://github.com/BrightcoveOS/evaporate-brightcove</a>。請注意，該庫是開源的，並且Brightcove並未正式支持該庫。</p>
    </aside>
    
    <p>這些請求在下面的部分中有詳細說明。</p>
    </section>
    
    <section class="bcls-section">
    <h2 id="CMS_API_request">CMS API請求</h2>
    
    <p>這<span translate="No">內容管理系統 API</span>請求與添加新視頻的任何動態攝取操作相同。需要此請求才能攝取新視頻。如果要替換現有視頻或向現有視頻添加資產，則不需要此步驟-相反，您將在其他請求中使用現有視頻ID。</p>
    
    <h3>請求語法</h3>
    
    <p>這是一個<code translate="No">POST</code>請求：</p>
    
    <pre class="line-numbers">
      <code class="language-http" translate="No">https://cms.api.brightcove.com/v1/accounts/<span class="bcls-highlight">{ACCOUNT_ID}</span>/videos</code></pre>
    
    <h4>參數</h4>
    
    <p>請求的 URL 參數：</p>
    
    <ul>
      <li><code translate="No">{ACCOUNT_ID}</code> -您的帳戶ID</li>
    </ul>
    
    <h4>要求正文</h4>
    
    <p>請求正文包含一個 JSON 對象，其中包含<code translate="No">name</code>（必需）和視頻的其他元數據（可選）：</p>
    
    <pre class="line-numbers">
      <code class="language-json" translate="No">{
      "name": "My Video"
      }</code></pre>
    
    <p>見<a href="/dynamic-ingest/references/reference.html#api-Video-Create_Video_Object">API 參考</a>詳情。</p>
    
    <h4>標頭</h4>
    
    <p>您需要包含在請求中的 HTTP 標頭是：</p>
    
    <ul>
      <li><code translate="No">Authorization: Bearer {ACCESS_TOKEN}</code></li>
      <li><code translate="No">Content-Type: application/json</code></li>
    </ul>
    
    <h4>回复</h4>
    
    <p>響應將是一個包含視頻元數據的 JSON 對象。其餘動態攝取操作的重要項目是<code translate="No">id</code>，您將用它代替<code translate="No">{VIDEO_ID}</code>在對 Ingest API 的請求中。</p>
    </section>
    
    <section class="bcls-section">
    <h2 id="Request_for_S3_URLs">要求提供S3網址</h2>
    
    <p>對 Ingest API 的第一個請求將檢索您將源文件放入 Brightcove S3 存儲桶，然後從那裡攝取到視頻雲所需的信息。</p>
    
    <h3>請求語法</h3>
    
    <p>這是一個<code translate="No">GET</code>請求：</p>
    
    <pre class="line-numbers">
      <code class="language-http" translate="No">https://ingest.api.brightcove.com/v1/accounts/<span class="bcls-highlight">{ACCOUNT_ID}</span>/videos/<span class="bcls-highlight">{VIDEO_ID}</span>/upload-urls/<span class="bcls-highlight">{SOURCE_NAME}</span></code></pre>
    
    <h4>參數</h4>
    
    <p>請求的 URL 參數：</p>
    
    <ul>
      <li><code translate="No">{ACCOUNT_ID}</code> -您的帳戶ID</li>
      <li><code translate="No">{VIDEO_ID}</code> - 返回的視頻 ID <span translate="No">內容管理系統 API</span>要求</li>
      <li><code translate="No">{SOURCE_NAME}</code> -視頻源文件名- <strong>名稱中不應包含任何保留URL的字符，例如<code translate="No">?</code>，<code translate="No">&amp;</code>，<code translate="No">#</code>或空格</strong></li>
    </ul>
    
    <h4>標頭</h4>
    
    <p>您需要包含在請求中的 HTTP 標頭是：</p>
    
    <ul>
      <li><code translate="No">Authorization: Bearer {ACCESS_TOKEN}</code></li>
    </ul>
    
    <h4>回复</h4>
    
    <p>響應將是類似於以下內容的 JSON 對象：</p>
    
    <pre class="line-numbers">
      <code class="language-json" translate="No">{
      "bucket": "ingestion-upload-production",
      "object_key": "57838016001/4752143002001/ed5a5ba0-1d97-4f95-a8ec-cbb786b04a37/greatblueheron.mp4",
      "access_key_id": "ACCESS_KEY_APPEARS_HERE",
      "secret_access_key": "SECRET_ACCESS_KEY_APPEARS_HERE",
      "session_token": "FQoDYXdzEKf//////////wEaDKR0wDgquq/qvkZgbyKOA7URC/9io6cmRBDkhbvxoHIKkPZlK/9YNvdWcESPkm75/2PvU6FV1Mc+/XENPzY8KgvP86MBJNxYLPdkuP1phgHs2Yh2p1KIDcQSCZJ3i6i9m4S14ewjWIugYLYDQi6CG+3fiFwfzbKT5jes1kh24m9BQQIuvVOiM1GLTldyDzlrdDopJkdYd4IEU7FU36CUT7RL/aeMwR2Usk56nwqyqkkQHPmvqmGyiLdrD3OrIbUU+6+ZP4usS9dbV3eAqOWDIk3HCN+Kuc9f/eUWhY21ftNDXWgasqQqXwPRs3T1i/hoiIKODbzr8F",
      <span class="bcls-highlight">"signed_url": "https://ingestion-upload-production.s3.amazonaws.com/57838016001/4752143002001/ed5a5ba0-1d97-4f95-a8ec-cbb786b04a37/greatblueheron.mp4?AWSAccessKeyId=ACCESS_KEY_HERE&amp;Expires=1475673952&amp;Signature=%2Fsr5cV%2FVOfGCBkodol9xQIKlbu4%3D"</span>,
      <span class="bcls-highlight">"api_request_url": "https://ingestion-upload-production.s3.amazonaws.com/57838016001/4752143002001/ed5a5ba0-1d97-4f95-a8ec-cbb786b04a37/greatblueheron.mp4"</span>
      }</code></pre>
    
    <p>響應中的項目是：</p>
    
    <ul>
      <li><code translate="No">bucket</code> -S3存儲桶名稱</li>
      <li><code translate="No">object_key</code> -文件上傳的對象鍵（用於構造分段上傳的目標URL）</li>
      <li><code translate="No">access_key_id</code> -用於驗證上傳請求的訪問密鑰（用於分段上傳）</li>
      <li><code translate="No">secret_access_key</code> -用於驗證上傳請求的秘密訪問密鑰（用於分段上傳）</li>
      <li><code translate="No">session_token</code> -短暫的AWS令牌，提供了寫入目標objec的功能</li>
      <li><code translate="No">signed_url</code> -這是一個簡寫的S3網址，如果您的視頻相對較小並且未實現分段上傳，則可以將其放到源文件中</li>
      <li><code translate="No">api_request_url</code> -這是您將在動態收錄POST請求中包含的主URL或圖像/ text_tracks資產的URL中的URL</li>
    </ul>
    
    <p>建議您使用適用於所使用語言的AWS開發工具包進行分段上傳。SDK 可用於多種語言，包括 Java、.NET、Ruby、PHP、Python、JavaScript、Go 和 C++。見<a href="https://aws.amazon.com/blogs/developer/">AWS 開發人員博客</a>想要查詢更多的信息。</p>
    
    <p>如果您要實施分段上傳，則以下文檔和示例代碼將非常有用：</p>
    
    <ul>
      <li><a href="//docs.aws.amazon.com/AmazonS3/latest/dev/llJavaUploadFile.html">上傳一個文件</a></li>
      <li><a href="//github.com/BrightcoveLearning/dynamic-ingest-code-samples/blob/master/dynamic-ingest/java/src/main/java/com/brightcove/ingest/App.java">Java樣本</a></li>
      <li><a href="//github.com/BrightcoveLearning/dynamic-ingest-code-samples/blob/master/dynamic-ingest/python/di-example-source-file-multipart-upload.py">Python樣本</a></li>
    </ul>
    
    <p>這是PHP中的簡單示例：</p>
    
    <pre class="line-numbers">
      <code class="language-php">&lt;?php // AWS SDK（用於推送攝取）需要 'vendor/aws-autoloader.php';使用 Aws\\S3\\S3Client;使用 Aws\\S3\\MultipartUploader；使用 Aws\\Exception\\MultipartUploadException; /** * 如本文檔中所述獲取 S3 信息 * 下面的代碼假定它已被解碼為 $s3response * 並且 $filePath 是資產文件的本地路徑 */ s3 = new S3Client([ 'version'  =&gt; '最新', '地區'  =&gt; 'us-east-1', '憑據'  =&gt; 數組('鍵'  =&gt; $s3response-&gt;access_key_id, '秘密'  =&gt; $s3response-&gt;secret_access_key, '令牌'  =&gt; $s3response-&gt;session_token ) ]); $params = array('桶'  =&gt; $s3response-&gt;s3-&gt;bucket, 'key'  =&gt; $s3response-&gt;s3-&gt;object_key ); $uploader = new MultipartUploader($this-&gt;s3, $filePath, $params);嘗試{ $uploadResponse = $uploader-&gt;upload(); } catch (MultipartUploadException $e) { echo $e-&gt;getMessage() . "\n"; } ?&gt;</code></pre>
    
    <aside class="bcls-aside bcls-aside--information">
    <ul>
      <li>請注意，這些網址對<strong>24小時</strong> -如果您未在24小時內完成動態提取操作，則必須重新請求新的網址。</li>
      <li>動態提取每個帳戶最多可以同時運行100個作業</li>
    </ul>
    </aside>
    </section>
    
    <section class="bcls-section">
    <h2 id="PUT_source_files_to_S3">將源文件放入S3</h2>
    
    <p>取得S3網址後，您可以使用<code translate="No">signed_url</code>作為目的地。</p>
    
    <p>您可以使用以下<a href="https://general.support.brightcove.com/developer/concepts-set-curl.html">捲曲</a>測試 PUT 操作的命令：</p>
    
    <pre class="line-numbers">
      <code class="language-bash" translate="No">curl -X PUT "<span class="bcls-input">SIGNED_URL_GOES_HERE</span>" --upload-file <span class="bcls-input">FILE_PATH_FOR_LOCAL_ASSET_GOES_HERE</span> </code></pre>
    
    <h3>單次上傳與分段上傳</h3>
    
    <p>AWS允許單部分上傳最大5 GB的文件（文件大小沒有其他限制）。對於較大的文件，必須使用分段上傳。儘管單部分上傳更容易設置，但我們建議您盡可能使用分段上傳。這是兩者之間的區別：</p>
    
    <ul>
      <li>單部分上傳將視頻全部上傳為一個文件。單部分上傳的文件大小限制為 5 GB 或更小。如果上載由於某種原因而中斷，則必須重新開始。</li>
      <li>分段上傳會將文件分塊推送。這更有效，因為上傳可以利用多個連接。另外，如果上傳中斷，則可以從剩餘的大塊中恢復。</li>
    </ul>
    
    <aside class="bcls-aside bcls-aside--information">請注意，此過程中的這一步超出了 Brightcove 支持的範圍。添加文件的 PUT 請求需要遵循 AWS S3 約定。以下鏈接可能會有所幫助：
    <ul>
      <li><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UploadInSingleOp.html">AWS S3單一操作上傳</a></li>
      <li><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/uploadobjusingmpu.html">AWS S3分段上傳</a></li>
      <li><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/Presigned_urlUploadObject.html">使用預簽名URL的AWS S3上傳</a></li>
    </ul>
    </aside>
    </section>
    
    <section class="bcls-section">
    <h2 id="Dynamic_Ingest_request">動態提取請求</h2>
    
    <p>將文件上傳到Brightcove S3存儲桶後，您將發出普通的Dynamic Ingest請求，以從其S3位置提取文件。</p>
    
    <h3>請求語法</h3>
    
    <p>這是一個<code translate="No">POST</code>請求：</p>
    
    <pre class="line-numbers">
      <code class="language-http" translate="No">https://ingest.api.brightcove.com/v1/accounts/<span class="bcls-highlight">{ACCOUNT_ID}</span>/videos/<span class="bcls-highlight">{VIDEO_ID}</span>/ingest-requests</code></pre>
    
    <h4>參數</h4>
    
    <p>請求的 URL 參數：</p>
    
    <ul>
      <li><code translate="No">{ACCOUNT_ID}</code> -您的帳戶ID</li>
      <li><code translate="No">{VIDEO_ID}</code> - 返回的視頻 ID <span translate="No">內容管理系統 API</span>要求</li>
    </ul>
    
    <h4>要求正文</h4>
    
    <p>請求正文包含一個 JSON 對象，其中包含<code translate="No">master</code>（必需）攝取作業的詳細信息。這<code translate="No">url</code>為了<code translate="No">master</code>將是<code translate="No">api_request_url</code>由對 S3 存儲桶信息的請求返回</p>
    
    <pre class="line-numbers">
      <code class="language-json" translate="No">{
      "master": {
          "url": "<span class="bcls-highlight">https://ingestion-upload-prod.s3.amazonaws.com/12345/5678/3712cd37504911ab06a77a26a387ce/source.mp4</span>"
      },
      "profile": "multi-platform-standard-static",
      "capture-images": true
      }</code></pre>
    
    <p>見<a href="/dynamic-ingest/references/reference.html#api-Ingest-Ingest_Media_Asset">API 參考</a>詳情。</p>
    
    <h4>標頭</h4>
    
    <p>您需要包含在請求中的 HTTP 標頭是：</p>
    
    <ul>
      <li><code translate="No">Authorization: Bearer {ACCESS_TOKEN}</code></li>
      <li><code translate="No">Content-Type: application/json</code></li>
    </ul>
    
    <h4>回复</h4>
    
    <p>響應將包含<code translate="No">job_id</code>對於攝取請求，它允許您通過以下方式跟踪狀態<a href="/dynamic-ingest/general/notifications-dynamic-delivery-video-cloud.html">通知</a> .</p>
    </section>
    
    <section class="bcls-section">
    <h2 id="Sample_code">示例代碼</h2>
    
    <p>為了幫助您開始使用基於推送的動態攝取，我們用 Java 和 Python 創建了一些示例應用程序。您可以在我們的<a href="//github.com/BrightcoveLearning/dynamic-ingest-code-samples">Github 站點</a> .</p>
    
    <aside class="bcls-aside bcls-aside--information">示例代碼按原樣提供，Brightcove 不支持。</aside>
    </section>
    </article>
  