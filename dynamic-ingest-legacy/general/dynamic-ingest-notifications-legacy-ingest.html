---
title: '動態攝取通知'
description: '在本主題中，您將了解動態攝取通知，它提供有關攝取作業進度的信息。請注意，本文檔僅適用於舊式攝取系統 - 有關動態交付，請參閱<a href="/dynamic-ingest/general/notifications-dynamic-delivery-video-cloud.html">動態攝取的通知</a>'
parent: 'General Information' 
grandparent: <span translate="No">動態攝取 API</span>傳統佈局：登台--- <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
    <section class="bcls-section">
    <h2 id="diAPI">動態提取API通知</h2>
    
    <p>您可以指定一個或多個回調 URL 以接收有關攝取過程結果的通知。您指定的 URL 應該用於可以接受 POST 請求的應用程序。通知將以JSON格式發送。</p>
    
    <aside class="bcls-aside bcls-aside--information">
    <h3>筆記</h3>
    
    <ul>
      <li>最多支持 10 個錯誤通知訂閱者。您可以包含 10 個以上的 URL 來接收通知，但只會處理前 10 個</li>
      <li>不接受以斜杠 (/) 結尾的 URL；例如，網址“https://my.domain.com/notification-receiver”有效，但“https://my.domain.com/notification-receiver/”無效</li>
      <li>或者，您可以使用<a href="/cms/references/reference.html#api-videoGroup-Get_Status_of_Ingest_Jobs">CMS API的狀態API</a>獲取特定視頻的提取作業的狀態。</li>
      <li>當前不支持基於HTTP2構建的服務器上的通知處理程序。發送到 HTTP2 服務器的通知可能無法在不返回任何錯誤的情況下傳遞。</li>
    </ul>
    </aside>
    
    <h3>設置</h3>
    
    <p>這是一個例子。</p>
    
    <ul>
      <li>pub id 為 57838016001 的用戶</li>
      <li>想要使用 Dynamic Ingest 上傳位於 https://s3.amazonaws.com/bucket/mysourcevideo.mp4 的源視頻文件</li>
      <li>想要上傳視頻 ID 為 5199670523001 的目錄中的現有標題</li>
      <li>使用高分辨率配置文件</li>
      <li>希望在分別位於 http://host1/path1 和 http://host2/path2 的兩個端點接收回調</li>
    </ul>
    
    <p>DI 請求如下所示：</p>
    
    <h4>POST請求</h4>
    <textarea class="bcls-code">https://ingest.api.brightcove.com/v1/accounts/57838016001/videos/5199670523001/ingest-requests</textarea>
    
    <h4>要求正文</h4>
    <textarea class="bcls-code" style="height:10em;">{ "master": { "url": "https://s3.amazonaws.com/bucket/mysourcevideo.mp4" } , "profile": "高分辨率", "回調": ["http://host1/path1", "http://host2/path2"] }
        </textarea>
    
    <h3>示例通知</h3>
    
    <p>通知作為 POST 請求發送，請求正文中的通知為 JSON <sup> <strong><a href="#note1">[1]</a></strong> </sup>.以下是一些示例通知：</p>
    
    <pre class="line-numbers">
    <code class="language-json" translate="No">{
        "accountId": "57838016001",
        "entityType": "ASSET",
        "version": "1",
        "status": "SUCCESS",
        "videoId": "5199670523001",
        "entity": "5199679295001",
        "action": "CREATE",
        "jobId": "699db2e5-aeb7-4765-a4a7-2cc68c7360bd"
    }
    {
        "action": "CREATE",
        "status": "SUCCESS",
        "entityType": "DIGITAL_MASTER",
        "videoId": "5199670523001",
        "entity": "5199670523001",
        "accountId": "57838016001",
        "version": "1",
        "jobId": "699db2e5-aeb7-4765-a4a7-2cc68c7360bd"
    }
    {
        "entityType": "ASSET",
        "status": "SUCCESS",
        "action": "CREATE",
        "entity": "5199680423001",
        "profileRefId": "ts7",
        "version": "1",
        "accountId": "57838016001",
        "videoId": "5199670523001",
        "jobId": "699db2e5-aeb7-4765-a4a7-2cc68c7360bd"
    }
    {
        "jobId": "699db2e5-aeb7-4765-a4a7-2cc68c7360bd",
        "accountId": "57838016001",
        "version": "1",
        "status": "SUCCESS",
        "entityType": "TITLE",
        "entity": "5199670523001",
        "videoId": "5199670523001",
        "action": "CREATE"
    }</code></pre>
    
    <h4>筆記</h4>
    
    <ul>
      <li id="note1"><sup><strong>  [ 1] </strong>   </sup> 例外：DRM打包內容的所有通知均以鍵/值對的形式返回。在這種情況下，<code translate="No">Content-Type</code>標頭將是<code translate="No">application/x-www-form-urlencoded</code>。否則，<code translate="No">Content-Type</code>將<code translate="No">application/json</code></li>
    </ul>
    
    <h3>通知欄位</h3>
    
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>物品</th>
          <th>描述</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><code translate="No">status</code></td>
          <td>將會<code translate="No">FAILED</code>如果再現的攝取或創建不成功，<code translate="No">SUCCESS</code>如果請求成功</td>
        </tr>
        <tr>
          <td><code translate="No">accountId</code></td>
          <td>帳戶 ID</td>
        </tr>
        <tr>
          <td><code translate="No">videoId</code></td>
          <td>視頻 ID</td>
        </tr>
        <tr>
          <td><code translate="No">jobId</code></td>
          <td>動態攝取請求的作業 ID</td>
        </tr>
        <tr>
          <td style="vertical-align:top;"><code translate="No">profileRefId</code></td>
          <td>
          <p>對於視頻再現，這將是<code translate="No">reference id</code>您在提取配置文件中為演繹指定的內容。</p>
    
          <p>對於清單，<code translate="No">profileRefId</code>將指示清單的類型：</p>
    
          <ul>
            <li><code translate="No">HlsManifest</code>用於HLS NG清單</li>
            <li><code translate="No">HdsManifest</code>用於HDS清單</li>
            <li><code translate="No">DashManifest</code>用於DASH清單（2-清單資產之一用於MAPI中的消費，另一資產用於CMS API中的消費）</li>
            <li><code translate="No">SmoothIsmManifest</code>平滑清單（2-清單資產之一用於MAPI中的消耗，另一資產用於CMS API中的消耗）</li>
          </ul>
          </td>
        </tr>
        <tr>
          <td><code translate="No">entity</code></td>
          <td>如果存在，則為已攝取或失敗的資產的視頻雲ID（如果在視頻雲中成功創建了視頻對象）</td>
        </tr>
        <tr>
          <td><code translate="No">entityType</code></td>
          <td>報告的資產類型 - 例如：TITLE（視頻）、DIGITAL_MASTER、ASSET（再現、字幕文件或圖像）</td>
        </tr>
        <tr>
          <td><code translate="No">errorMessage</code></td>
          <td>解釋為什麼攝取失敗的原因</td>
        </tr>
        <tr>
          <td><code translate="No">version</code></td>
          <td>始終等於的字符串<code translate="No">"1"</code></td>
        </tr>
        <tr>
          <td><code translate="No">action</code></td>
          <td>發生的動作 - 例如，CREATE</td>
        </tr>
      </tbody>
    </table>
    
    <h3>解釋通知</h3>
    
    <p>包含以下內容的通知<code translate="No">"action": "CREATE"</code>和<code translate="No">"status": "SUCCESS"</code>表示過程已完成。</p>
    
    <ul>
      <li>如果<code translate="No">entityType</code>是<code translate="No">TITLE</code>，則提取視頻的處理完成。</li>
      <li>如果<code translate="No">entityType</code>是<code translate="No">ASSET</code>，則演示文稿，圖像，清單或WebVTT文件已成功添加到您的視頻中。</li>
    </ul>
    
    <p class="BCL-aside">注意：<code translate="No">"status": "SUCCESS"</code>在一個<strong>標題</strong>表示處理已完成，但不一定表示已成功創建所有移演。要確定動態攝取視頻是否成功，請參閱<a href="/dynamic-ingest/general/get-status-dynamic-ingest-requests-dynamic-delivery.html">獲取動態攝取請求的狀態</a></p>
    </section>
    
    <section class="bcls-section">
    <h2 id="sampleApp">基本示例應用</h2>
    
    <p>下面是一個簡單的日誌記錄應用程序的代碼<span translate="No">動態攝取 API</span>通知。此應用程序是用 PHP 編寫的，但您可以使用任何語言，只要該應用程序具有面向公眾的 URL 並且可以處理 http(s) POST 請求。</p>
    
    <p>你可以看到這個應用生成的日誌文件<a href="//solutions.brightcove.com/bcls/di-api/di-log.txt">這裡。</a></p>
    
    <p class="BCL-aside">注意：如果您嘗試自己實現此應用，則需要確保該應用具有寫入日誌文件的權限。還要記住，日誌文件可以快速增長-您可能需要定期清空它。</p>
    
    <pre class="line-numbers">
    <code class="language-php">&lt;?php // POST 不適用於 JSON 數據 $problem = "No errors";嘗試{ $json = file_get_contents('php://input'); $decoded = json_decode($json, true); }捕獲（異常 $e）{ $problem = $e-&gt;getMessage(); } // 將通知變成漂亮的 JSON $notification = json_encode($decoded, JSON_PRETTY_PRINT); $logEntry = $notification。 "\\n接收通知時出錯：".$problem. "\\n-------------------------------\\n"; // 最後，告訴 PHP 在哪裡可以找到日誌文件並告訴 PHP 打開它 // 並將我們之前創建的字符串添加到它。 $logFileLocation = "di-log.txt"; $fileHandle = fopen($logFileLocation, 'a') 或 die("-1"); fwrite($fileHandle, $logEntry); fclose($fileHandle); // 直接瀏覽應用時顯示下面一行 echo "Dynamic Ingest callback app is running"; ?&gt;</code></pre>
    </section>
    </article>
  